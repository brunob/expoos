<INCLURE{fond=modeles/carte_gis,
	id_rubrique,
	id_map=_expo,
	point=non,
	fullscreen=oui}>
<BOUCLE_svg(DOCUMENTS){id_rubrique}{extension=svg}{0,1}>
[(#FICHIER|balise_svg)][(#SET{overlay,oui})]
</BOUCLE_svg>
<script type="text/javascript">
	;(function($){
		$('#map_expo').on('load', function(){
			// pictos perso pour les markers
			this.map.setGeoJsonFeatureIcon = function(feature, layer) {
				layer.setIcon(L.divIcon({ html: '<div><span></span></div>', className: 'marker-dot', iconSize: new L.Point(40, 40) }));
			}
			// pas de popup pour les markers, le click renvoie direct vers l'article
			this.map.setGeoJsonFeaturePopup = function(feature, layer) {
				layer.on('click', function(e){
					location = e.sourceTarget.feature.properties.url;
				});
			}
		});
		$('#map_expo').on('ready', function(){
			// charger le geojson des points
			var geojson = <INCLURE{fond=gis_json,id_rubrique,objets=expo}>;
			this.map.parseGeoJson(geojson);[(#GET{overlay}|oui)
			// afficher le SVG du plan en overlay
			var svgElement = document.querySelector('#plan'),
			bounds = L.latLngBounds(eval(svgElement.getAttribute('data-bbox')));
			L.svgOverlay(svgElement, bounds).addTo(this.map);]
			<BOUCLE_center(GIS){id_article}{annexe=''}>
			this.map.setView(\[[(#LAT)],[(#LON)]\],20);
			$('#map_expo').hide();
			</BOUCLE_center>[(#GET{overlay}|oui)
			// centrer la carte sur les bounds du SVG
			this.map.fitBounds(bounds);][(#GET{overlay}|non)
			// centrer la carte sur les bounds du json
			this.map.fitBounds(L.geoJSON(geojson).getBounds());]
			<//B_center>
		});
})(jQuery);
</script>